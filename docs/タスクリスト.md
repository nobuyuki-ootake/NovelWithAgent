# ノベル作成エージェント 実装タスクリスト

このドキュメントは、ロードマップの各タスクを issue レベルの粒度に細分化したものです。

## フェーズ 1: MVP（ローカルデータ版）

### フロントエンド強化

#### データ保存・管理

- [x] **F1-01**: ローカルストレージの基本クラス実装
- [x] **F1-02**: プロジェクト型定義の最適化
- [x] **F1-03**: プロジェクト作成機能の実装
- [x] **F1-04**: プロジェクトの一覧表示とロード機能
- [x] **F1-05**: プロジェクトのエクスポート機能
- [x] **F1-06**: プロジェクトのインポート機能

#### タイムライン機能

- [] **F1-07**: タイムラインの基本 UI 実装
- [] **F1-08**: イベント追加・編集機能
- [] **F1-09**: ドラッグ＆ドロップ並べ替え
- [] **F1-10**: キャラクターとの連携機能

#### 本文執筆エディタ

- [] **F1-11**: 基本テキストエディタ実装
- [] **F1-12**: 章立て・見出し管理
- [] **F1-13**: エディタのショートカット設定
- [] **F1-14**: 編集履歴機能

#### UI 改善

- [] **F1-15**: メインナビゲーション改善
- [] **F1-16**: レスポンシブデザイン対応
- [] **F1-17**: ダークモード対応
- [] **F1-18**: アクセシビリティ対応

### 基本的な AI 連携

#### プロキシサーバー

- [] **A1-01**: Express.js プロジェクト設定
- [] **A1-02**: OpenAI API クライアント実装
- [] **A1-03**: エラーハンドリング実装
- [] **A1-04**: セキュリティ設定
- [] **A1-05**: 環境変数設定

#### チャット機能

- [] **A1-06**: AI チャットパネルの UI 実装
- [] **A1-07**: チャット履歴の状態管理
- [] **A1-08**: API 連携処理の実装
- [] **A1-09**: メッセージ入力 UI
- [] **A1-10**: ローディング表示

#### プロンプト設計

- [] **A1-11**: 基本システムプロンプト設計
- [] **A1-12**: プロット用プロンプト作成
- [] **A1-13**: キャラクター用プロンプト作成
- [] **A1-14**: 文章校正用プロンプト作成

### テスト・安定化

#### E2E テスト

- [] **T1-01**: Playwright セットアップ
- [] **T1-02**: 基本機能テスト実装
- [] **T1-03**: ナビゲーションテスト
- [] **T1-04**: データ操作テスト

#### エラーハンドリング

- [] **T1-05**: グローバルエラーハンドリング
- [] **T1-06**: ネットワークエラー対応
- [] **T1-07**: データ破損時の回復機能
- [] **T1-08**: エラーメッセージ改善

### リリース準備

- [] **R1-01**: ユーザーガイド作成
- [] **R1-02**: プライバシーポリシー作成
- [] **R1-03**: フィードバック機能実装

## フェーズ 2: 基本収益化版

### バックエンド強化

#### 認証システム

- [] **B2-01**: Firebase Auth 設定
- [] **B2-02**: ログイン機能実装
- [] **B2-03**: セッション管理
- [] **B2-04**: 権限管理実装

#### API キー管理

- [] **B2-05**: API キー暗号化実装
- [] **B2-06**: API キー管理テーブル設計
- [] **B2-07**: API キー管理 API 実装
- [] **B2-08**: API キー管理 UI 実装

#### キャッシュ

- [] **B2-09**: Redis 設定
- [] **B2-10**: キャッシュ機能実装
- [] **B2-11**: キャッシュ無効化実装
- [] **B2-12**: キャッシュ監視機能

#### デプロイ

- [] **B2-13**: Railway 設定
- [] **B2-14**: デプロイパイプライン構築
- [] **B2-15**: 環境変数管理
- [] **B2-16**: スケーリング設定

### AI 機能拡張

#### 役割ベース AI

- [] **A2-01**: プロットアドバイザー実装
- [] **A2-02**: キャラクターデザイナー実装
- [] **A2-03**: 文体エディター実装
- [] **A2-04**: 世界観構築アシスタント実装
- [] **A2-05**: エージェント切り替え UI

#### コンテキスト選択型対話

- [] **A2-06**: 選択 UI の実装
- [] **A2-07**: コンテキスト状態管理
- [] **A2-08**: AI プロンプト統合
- [] **A2-09**: コンテキスト最適化

### 収益化基盤

#### 広告

- [] **M2-01**: 広告プラットフォーム統合
- [] **M2-02**: 広告表示 UI 実装
- [] **M2-03**: 広告ブロック対応
- [] **M2-04**: 広告パフォーマンス測定

#### プレミアム機能

- [] **M2-05**: 機能フラグ管理
- [] **M2-06**: 広告非表示オプション
- [] **M2-07**: プレミアム AI 機能
- [] **M2-08**: プレミアム紹介ページ

#### 課金システム

- [] **M2-09**: Stripe 統合
- [] **M2-10**: サブスクリプション管理
- [] **M2-11**: 支払い UI 実装
- [] **M2-12**: 請求書生成

### クラウド連携

- [] **C2-01**: クラウドストレージ設計
- [] **C2-02**: プロジェクト保存 API
- [] **C2-03**: バージョン管理
- [] **C2-04**: デバイス間同期機能

## フェーズ 3/4 の主要タスク（概要）

### データベース導入

- [] **D3-01**: PostgreSQL 設計
- [] **D3-02**: マイグレーション実装
- [] **D3-03**: バックアップ機能

### AI 機能高度化

- [] **A3-01**: 複数 AI 提供元統合
- [] **A3-02**: エージェント間協調機能
- [] **A3-03**: ユーザー好み学習機能
- [] **A3-04**: カスタム AI パーソナリティ

### コミュニティ機能

- [] **CM3-01**: テンプレート共有機能
- [] **CM3-02**: 作品公開機能
- [] **CM3-03**: フィードバックシステム

### 収益モデル多様化

- [] **M3-01**: 複数サブスクリプションプラン
- [] **M3-02**: 使用量ベース課金
- [] **M3-03**: マーケットプレイス実装

## 依存関係

主要な依存関係は以下の通りです：

- F1-03 ← F1-01, F1-02
- F1-04 ← F1-03
- A1-06 ← A1-02
- T1-02 ← F1-03, F1-04
- B2-07 ← B2-05, B2-06
- A2-05 ← A2-01, A2-02, A2-03, A2-04
- M2-06 ← M2-01, M2-05

## 優先度ランク

- **P0**: 必須（MVP 必須）
- **P1**: 高優先
- **P2**: 中優先
- **P3**: 低優先

### P0 優先度タスク

- F1-01, F1-02, F1-03, F1-04
- F1-11, F1-12
- A1-01, A1-02, A1-03
- A1-06, A1-07, A1-08
- T1-01, T1-05
- R1-01

#### キャラクター状態管理とタイムライン連携 (新規)

- [] **F1-19**: キャラクター状態型 (`CharacterStatus`) の UI 実装
  - キャラクター詳細画面に状態一覧表示機能を追加
  - 状態追加・編集・削除用ダイアログ (`CharacterStatusEditor`) 作成
- [] **F1-20**: キャラクター状態と移動制限の編集ロジック実装
  - `CharacterStatusEditor` で状態名、タイプ、移動制限、説明を編集・保存する機能
  - `Character` オブジェクトの `statuses` プロパティを更新し、ローカルストレージに永続化
- [] **F1-21**: タイムラインイベントでのキャラクター状態変更機能
  - `TimelineEventDialog` に参加キャラクターごとの状態変更セクションを追加
  - イベント実行後のキャラクター状態 (`postEventCharacterStatuses`) を設定・保存する機能
  - イベント実行前の状態を表示する機能
- [] **F1-22**: キャラクター状態履歴の参照・比較 UI (簡易版)
  - タイムラインイベント編集時に、イベント前後の状態変化を分かりやすく表示
  - (将来的に) キャラクターページやタイムライン全体で状態変遷を追えるようにする
